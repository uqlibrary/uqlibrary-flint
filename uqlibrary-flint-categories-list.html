<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized-flint.html">
<polymer-element name="uqlibrary-flint-categories-list" fit vertical layout>

<template>
  <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">
  <uqlibrary-api-flint-voices id="voicesApiElement"></uqlibrary-api-flint-voices>
  <uqlibrary-api-flint-languages id="languagesApiElement"></uqlibrary-api-flint-languages>

  <ul class="single-line-list">
    <core-list id="itemsList" fit on-core-activate="{{itemSelected}}" data="{{items}}" groups="{{groups}}">
      <template>

        <li class="list-item header" divider>
            {{groupModel.label}}
        </li>

        <li class="list-item" data-index="{{index}}">
          <div class="content" relative horizontal layout>
            <paper-ripple fit></paper-ripple>
            <div flex>
              <uqlibrary-a11y-link data-index="{{index}}" on-tap="{{ itemSelectedKeyPressed }}">{{model.cvo_title}}</uqlibrary-a11y-link>
            </div>
            <div>
              ({{model.cvo_count}})
            </div>
          </div>
        </li>
      </template>
    </core-list>
  </ul>
</template>

<script>
  (function() {
    Polymer('uqlibrary-flint-categories-list', {

      ready: function() {
        this.items = null;
        this.groups = null;

        var that = this;

        this.$.languagesApiElement.addEventListener("uqlibrary-api-flint-languages-loaded", function(data){
          that.items = data.detail.items;
          that.groups = data.detail.groups;
        });

        this.$.voicesApiElement.addEventListener("uqlibrary-api-flint-voices-loaded", function(data){
          that.items = data.detail.items;
          that.groups = data.detail.groups;
        });
      },

      setData: function(args) {
        if (args && args.displayLanguages) {
          if (args.items) {
            //set data passed as a parameter
            this.items = args.items;
            this.groups = args.groups;
          }
          else if (!this.items) {
            //get data from api if no data has been passed
            this.$.languagesApiElement.get();
          }
        } else if (args && args.displayVoices){
          if (args.items) {
            //set data passed as a parameter
            this.items = args.items;
            this.groups = args.groups;
          }else if (!this.items) {
            //get data from api if no data has been passed
            this.$.voicesApiElement.get();
          }
        }
      },

      itemSelected: function(event, itemRow, list) {
        this.fire("category-selected", itemRow.data);
      },

      itemSelectedKeyPressed: function(source) {
        if (source.path && source.path.length > 0 && source.path[0].attributes["data-index"]) {
          var itemIndex = source.path[0].attributes["data-index"].value;
          this.itemSelected(null, { data: this.$.itemsList.data[itemIndex], item: source.path[3] }, null);
        }
      }
    });
  })();
</script>
</polymer-element>
